(()=>{var e={};e.id=938,e.ids=[938],e.modules={7849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},1017:e=>{"use strict";e.exports=require("path")},7310:e=>{"use strict";e.exports=require("url")},6118:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>n.a,__next_app__:()=>m,originalPathname:()=>u,pages:()=>d,routeModule:()=>p,tree:()=>c});var a=r(482),s=r(9108),i=r(2563),n=r.n(i),o=r(8300),l={};for(let e in o)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>o[e]);r.d(t,l);let c=["",{children:["settings",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,9700)),"C:\\Tools\\foodiary\\src\\app\\settings\\page.tsx"]}]},{metadata:{icon:[async e=>(await Promise.resolve().then(r.bind(r,7026))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(r.bind(r,1342)),"C:\\Tools\\foodiary\\src\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,9361,23)),"next/dist/client/components/not-found-error"],metadata:{icon:[async e=>(await Promise.resolve().then(r.bind(r,7026))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}],d=["C:\\Tools\\foodiary\\src\\app\\settings\\page.tsx"],u="/settings/page",m={require:r,loadChunk:()=>Promise.resolve()},p=new a.AppPageRouteModule({definition:{kind:s.x.APP_PAGE,page:"/settings/page",pathname:"/settings",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},6315:(e,t,r)=>{Promise.resolve().then(r.t.bind(r,2583,23)),Promise.resolve().then(r.t.bind(r,6840,23)),Promise.resolve().then(r.t.bind(r,8771,23)),Promise.resolve().then(r.t.bind(r,3225,23)),Promise.resolve().then(r.t.bind(r,9295,23)),Promise.resolve().then(r.t.bind(r,3982,23))},5229:(e,t,r)=>{Promise.resolve().then(r.t.bind(r,2704,23))},8275:(e,t,r)=>{Promise.resolve().then(r.bind(r,4895))},4895:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>l});var a=r(5344),s=r(3729),i=r(6506),n=r(6244),o=r(333);function l(){let[e,t]=(0,s.useState)(!1),[l,c]=(0,s.useState)(!1),[d,u]=(0,s.useState)(!0),[m,p]=(0,s.useState)(!1),[h,g]=(0,s.useState)(null),x=(0,s.useRef)(null);(0,s.useEffect)(()=>{(async()=>{let e=(0,o.DB)();t(e),e&&c(await (0,o.OK)()),u(!1)})()},[]);let w=(e,t)=>{g({type:e,text:t}),setTimeout(()=>g(null),3e3)},y=async()=>{try{if(await (0,o.j7)()){c(!0),w("success","フォルダを設定しました。データが自動保存されます。");let e=await (0,n.C0)();if(e.length>0){let{saveToFile:t}=await Promise.resolve().then(r.bind(r,333));await t(e)}}}catch(e){console.error("フォルダ選択に失敗しました:",e),w("error","フォルダの選択に失敗しました")}},f=async()=>{confirm("フォルダ設定を解除しますか？\n（保存済みのファイルは削除されません）")&&(await (0,o.vU)(),c(!1),w("success","フォルダ設定を解除しました"))},b=async()=>{if(confirm("ファイルからデータを読み込みますか？\n現在のデータはファイルの内容で上書きされます。")){p(!0);try{let e=await (0,o.eR)();if(null===e){w("error","ファイルの読み込みに失敗しました");return}await (0,n.Ps)(),e.length>0&&await (0,n.PZ)(e),w("success",`${e.length}件のデータを読み込みました`)}catch(e){console.error("同期に失敗しました:",e),w("error","同期に失敗しました")}finally{p(!1)}}},v=async()=>{try{let e=await (0,n.C0)();await (0,o.VE)(e),w("success","データをエクスポートしました")}catch(e){console.error("エクスポートに失敗しました:",e),w("error","エクスポートに失敗しました")}},j=async e=>{let t=e.target.files?.[0];if(t){if(!confirm("ファイルからデータをインポートしますか？\n同じIDのデータは上書きされます。")){e.target.value="";return}try{let e=await (0,o.Is)(t);await (0,n.PZ)(e),w("success",`${e.length}件のデータをインポートしました`)}catch(e){console.error("インポートに失敗しました:",e),w("error","インポートに失敗しました。ファイル形式を確認してください。")}finally{e.target.value=""}}};return a.jsx("main",{className:"min-h-screen bg-gradient-to-b from-green-50 to-white",children:(0,a.jsxs)("div",{className:"max-w-2xl mx-auto px-4 py-6",children:[(0,a.jsxs)("header",{className:"mb-8 flex items-center",children:[a.jsx(i.default,{href:"/",className:"mr-4 text-gray-600 hover:text-gray-800 transition",children:a.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),a.jsx("h1",{className:"text-3xl font-bold text-gray-800",children:"設定"})]}),h&&a.jsx("div",{className:`mb-6 p-4 rounded-lg ${"success"===h.type?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:h.text}),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("section",{className:"bg-white rounded-2xl shadow-lg p-6",children:[a.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-4",children:"自動保存"}),d?a.jsx("div",{className:"text-gray-600",children:"読み込み中..."}):e?l?(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center text-green-600",children:[a.jsx("svg",{className:"w-5 h-5 mr-2",fill:"currentColor",viewBox:"0 0 20 20",children:a.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),a.jsx("span",{children:"自動保存が有効です"})]}),a.jsx("p",{className:"text-sm text-gray-600",children:"データは自動的にローカルフォルダに保存されます。"}),(0,a.jsxs)("div",{className:"flex flex-wrap gap-2",children:[a.jsx("button",{onClick:b,disabled:m,className:"px-4 py-2 bg-blue-500 hover:bg-blue-600 disabled:bg-gray-400 text-white rounded-lg transition",children:m?"読み込み中...":"ファイルから読み込む"}),a.jsx("button",{onClick:f,className:"px-4 py-2 bg-gray-500 hover:bg-gray-600 text-white rounded-lg transition",children:"設定を解除"})]})]}):(0,a.jsxs)("div",{className:"space-y-4",children:[a.jsx("p",{className:"text-gray-600",children:"フォルダを選択すると、データが自動的にローカルファイルに保存されます。 ブラウザのデータを削除しても、ファイルからデータを復元できます。"}),a.jsx("button",{onClick:y,className:"px-4 py-2 bg-green-500 hover:bg-green-600 text-white rounded-lg transition",children:"保存フォルダを選択"})]}):(0,a.jsxs)("div",{className:"text-gray-600",children:[a.jsx("p",{className:"mb-2",children:"このブラウザは自動保存に対応していません。"}),a.jsx("p",{className:"text-sm text-gray-500",children:"Chrome または Edge を使用すると、ローカルフォルダへの自動保存が利用できます。"})]})]}),(0,a.jsxs)("section",{className:"bg-white rounded-2xl shadow-lg p-6",children:[a.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-4",children:"手動バックアップ"}),a.jsx("p",{className:"text-gray-600 mb-4",children:"全ブラウザ対応。JSONファイルとしてデータをダウンロード・復元できます。"}),(0,a.jsxs)("div",{className:"flex flex-wrap gap-2",children:[a.jsx("button",{onClick:v,className:"px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg transition",children:"データをエクスポート"}),a.jsx("button",{onClick:()=>{x.current?.click()},className:"px-4 py-2 bg-orange-500 hover:bg-orange-600 text-white rounded-lg transition",children:"データをインポート"}),a.jsx("input",{ref:x,type:"file",accept:".json",onChange:j,className:"hidden"})]})]})]})]})})}},6244:(e,t,r)=>{"use strict";r.d(t,{C0:()=>u,PZ:()=>p,Ps:()=>h,hv:()=>g,pO:()=>m,px:()=>d});var a=r(8505),s=r(333);let i="entries",n=null,o=()=>(n||(n=(0,a.openDB)("FoodDiaryDB",1,{upgrade(e){e.objectStoreNames.contains(i)||e.createObjectStore(i,{keyPath:"id"}).createIndex("by-date","date")}})),n),l=async()=>{try{if(await (0,s.yv)()){let e=await c();await (0,s.saveToFile)(e)}}catch(e){console.error("ファイル同期に失敗しました:",e)}},c=async()=>{let e=await o();return(await e.getAllFromIndex(i,"by-date")).reverse()},d=async e=>{let t=await o();await t.add(i,e),await l()},u=async()=>c(),m=async e=>{let t=await o();await t.delete(i,e),await l()},p=async e=>{let t=(await o()).transaction(i,"readwrite");for(let r of e)await t.store.put(r);await t.done,await l()},h=async()=>{let e=await o();await e.clear(i)},g=async(e,t=800,r=800,a=.8)=>new Promise((s,i)=>{let n=new FileReader;n.readAsDataURL(e),n.onload=e=>{let n=new Image;n.src=e.target?.result,n.onload=()=>{let e=document.createElement("canvas"),o=n.width,l=n.height;o>l?o>t&&(l*=t/o,o=t):l>r&&(o*=r/l,l=r),e.width=o,e.height=l;let c=e.getContext("2d");c?.drawImage(n,0,0,o,l),e.toBlob(e=>{e?s(e):i(Error("画像の圧縮に失敗しました"))},"image/jpeg",a)},n.onerror=i},n.onerror=i})},333:(e,t,r)=>{"use strict";r.d(t,{DB:()=>n,Is:()=>y,OK:()=>m,VE:()=>w,eR:()=>x,j7:()=>d,saveToFile:()=>g,vU:()=>f,yv:()=>u});let a="foodiary-data.json",s="file-handles",i="directory-handle",n=()=>"showDirectoryPicker"in window,o=async e=>{let{openDB:t}=await Promise.resolve().then(r.bind(r,8505)),a=await t("FileHandleStore",1,{upgrade(e){e.objectStoreNames.contains(s)||e.createObjectStore(s)}});await a.put(s,e,i)},l=async()=>{try{let{openDB:e}=await Promise.resolve().then(r.bind(r,8505)),t=await e("FileHandleStore",1,{upgrade(e){e.objectStoreNames.contains(s)||e.createObjectStore(s)}});return await t.get(s,i)||null}catch{return null}},c=async e=>{let t={mode:"readwrite"};return await e.queryPermission(t)==="granted"||await e.requestPermission(t)==="granted"},d=async()=>{if(!n())return null;try{let e=await window.showDirectoryPicker({mode:"readwrite",startIn:"documents"});return await o(e),e}catch(e){if(e instanceof Error&&"AbortError"===e.name)return null;throw e}},u=async()=>{let e=await l();return e&&await c(e)?e:null},m=async()=>null!==await l(),p=async e=>{let t={...e};if(e.photo instanceof Blob){let r=new FileReader,a=await new Promise((t,a)=>{r.onload=()=>t(r.result),r.onerror=a,r.readAsDataURL(e.photo)});t.photo=a,t._photoIsBase64=!0}return t},h=async e=>{let{_photoIsBase64:t,...r}=e,a=r.mealType||"昼食",s=r.menu||r.menuName,i={id:r.id,date:r.date,time:r.time,mealType:a,menu:s,photo:r.photo,createdAt:r.createdAt};if(t&&"string"==typeof r.photo){let e=await fetch(r.photo);i.photo=await e.blob()}return i},g=async e=>{let t=await u();if(!t)return!1;try{let r=await t.getFileHandle(a,{create:!0}),s=await r.createWritable(),i=await Promise.all(e.map(e=>p(e))),n=JSON.stringify({version:1,exportedAt:new Date().toISOString(),entries:i},null,2);return await s.write(n),await s.close(),!0}catch(e){return console.error("ファイルへの保存に失敗しました:",e),!1}},x=async()=>{let e=await u();if(!e)return null;try{let t=await e.getFileHandle(a),r=await t.getFile(),s=await r.text(),i=JSON.parse(s);if(!i.entries||!Array.isArray(i.entries))return null;return await Promise.all(i.entries.map(e=>h(e)))}catch(e){if(e instanceof Error&&"NotFoundError"===e.name)return[];return console.error("ファイルからの読み込みに失敗しました:",e),null}},w=async e=>{let t=await Promise.all(e.map(e=>p(e))),r=JSON.stringify({version:1,exportedAt:new Date().toISOString(),entries:t},null,2),a=new Blob([r],{type:"application/json"}),s=URL.createObjectURL(a),i=document.createElement("a");i.href=s,i.download=`foodiary-backup-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(s)},y=async e=>{let t=JSON.parse(await e.text());if(!t.entries||!Array.isArray(t.entries))throw Error("無効なファイル形式です");return await Promise.all(t.entries.map(e=>h(e)))},f=async()=>{let{openDB:e}=await Promise.resolve().then(r.bind(r,8505)),t=await e("FileHandleStore",1,{upgrade(e){e.objectStoreNames.contains(s)||e.createObjectStore(s)}});await t.delete(s,i)}},1342:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>c,metadata:()=>l,viewport:()=>o});var a=r(5036),s=r(3640),i=r.n(s);r(5023);var n=r(5411);let o={width:"device-width",initialScale:1,maximumScale:1,userScalable:!1,themeColor:"#10b981"},l={title:"食事記録アプリ",description:"食べたものを写真とメモで記録",manifest:"/manifest.json",appleWebApp:{capable:!0,statusBarStyle:"default",title:"食事記録"}};function c({children:e}){return(0,a.jsxs)("html",{lang:"ja",children:[(0,a.jsxs)("head",{children:[a.jsx("link",{rel:"icon",href:"/icon.svg",type:"image/svg+xml"}),a.jsx("link",{rel:"apple-touch-icon",href:"/icon.svg"})]}),(0,a.jsxs)("body",{className:i().className,children:[e,a.jsx(n.default,{id:"register-sw",strategy:"afterInteractive",children:`
            if ('serviceWorker' in navigator) {
              window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js').then(
                  (registration) => {
                    console.log('Service Worker registered:', registration);
                  },
                  (error) => {
                    console.log('Service Worker registration failed:', error);
                  }
                );
              });
            }
          `})]})]})}},9700:(e,t,r)=>{"use strict";r.r(t),r.d(t,{$$typeof:()=>i,__esModule:()=>s,default:()=>n});let a=(0,r(6843).createProxy)(String.raw`C:\Tools\foodiary\src\app\settings\page.tsx`),{__esModule:s,$$typeof:i}=a,n=a.default},7026:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>s});var a=r(337);let s=e=>[{type:"image/svg+xml",sizes:"any",url:(0,a.fillMetadataSegment)(".",e.params,"icon.svg")+"?bddd94b2250e474a"}]},5023:()=>{}};var t=require("../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[638,481,621],()=>r(6118));module.exports=a})();