exports.id=284,exports.ids=[284],exports.modules={6315:(e,t,r)=>{Promise.resolve().then(r.t.bind(r,2583,23)),Promise.resolve().then(r.t.bind(r,6840,23)),Promise.resolve().then(r.t.bind(r,8771,23)),Promise.resolve().then(r.t.bind(r,3225,23)),Promise.resolve().then(r.t.bind(r,9295,23)),Promise.resolve().then(r.t.bind(r,3982,23))},1543:(e,t,r)=>{Promise.resolve().then(r.t.bind(r,2704,23)),Promise.resolve().then(r.bind(r,5814))},5814:(e,t,r)=>{"use strict";r.r(t),r.d(t,{AuthProvider:()=>s,useAuth:()=>l});var a=r(5344),n=r(3729),i=r(8704);let o=(0,n.createContext)(void 0);function s({children:e}){let[t,r]=(0,n.useState)(null),[s,l]=(0,n.useState)(null),[u,d]=(0,n.useState)(!0),c=(0,i.e)(),w=(0,i.j)(),p=(0,n.useCallback)(async e=>{if(!c)return null;let{data:t,error:r}=await c.from("profiles").select("*").eq("id",e).single();return r?(console.error("プロフィール取得エラー:",r),null):t},[c]);(0,n.useEffect)(()=>{if(!c){d(!1);return}(async()=>{let{data:{session:e}}=await c.auth.getSession();e?.user&&(r(e.user),l(await p(e.user.id))),d(!1)})();let{data:{subscription:e}}=c.auth.onAuthStateChange(async(e,t)=>{t?.user?(r(t.user),l(await p(t.user.id))):(r(null),l(null)),d(!1)});return()=>{e.unsubscribe()}},[c,p]);let f={user:t,profile:s,loading:u,signUp:async(e,t)=>{if(!c)return{error:Error("Supabaseが設定されていません")};let{error:r}=await c.auth.signUp({email:e,password:t,options:{emailRedirectTo:`${window.location.origin}/auth/callback`}});return{error:r}},signIn:async(e,t)=>{if(!c)return{error:Error("Supabaseが設定されていません")};let{error:r}=await c.auth.signInWithPassword({email:e,password:t});return{error:r}},signOut:async()=>{c&&(await c.auth.signOut(),r(null),l(null))},isAuthenticated:!!t,plan:s?.plan||"free",isConfigured:w};return a.jsx(o.Provider,{value:f,children:e})}function l(){let e=(0,n.useContext)(o);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},2070:(e,t,r)=>{"use strict";r.d(t,{px:()=>h,Ps:()=>I,hv:()=>C,pO:()=>g,C0:()=>m,e9:()=>y,PZ:()=>b,ld:()=>v});var a=r(8505),n=r(333),i=r(8704);let o="food-photos",s=async(e,t,r)=>{let a=(0,i.e)();if(!a)return null;let n=`${e}/${t}.jpg`,{error:s}=await a.storage.from(o).upload(n,r,{contentType:"image/jpeg",upsert:!0});return s?(console.error("写真アップロードエラー:",s),null):n},l=async e=>{let t=(0,i.e)();if(!t)return null;let{data:r,error:a}=await t.storage.from(o).createSignedUrl(e,3600);return a?(console.error("URL取得エラー:",a),null):r.signedUrl},u=async e=>{let t=(0,i.e)();if(!t)return!1;let{error:r}=await t.storage.from(o).remove([e]);return!r||(console.error("写真削除エラー:",r),!1)},d="entries",c=null,w=()=>(c||(c=(0,a.openDB)("FoodDiaryDB",1,{upgrade(e){e.objectStoreNames.contains(d)||e.createObjectStore(d,{keyPath:"id"}).createIndex("by-date","date")}})),c),p=async()=>{try{if(await (0,n.yv)()){let e=await f();await (0,n.saveToFile)(e)}}catch(e){console.error("ファイル同期に失敗しました:",e)}},f=async()=>{let e=await w();return(await e.getAllFromIndex(d,"by-date")).sort((e,t)=>{let r=`${e.date}T${e.time||"00:00"}`;return`${t.date}T${t.time||"00:00"}`.localeCompare(r)})},h=async(e,t)=>{if(S(t))await D(e,t.userId);else{let t=await w();await t.add(d,e),await p()}},m=async e=>S(e)?P(e.userId):f(),y=async(e,t)=>{if(S(t))return E(e,t.userId);let r=await w();return await r.get(d,e)},g=async(e,t)=>{if(S(t))await A(e,t.userId);else{let t=await w();await t.delete(d,e),await p()}},v=async(e,t)=>{if(S(t))await B(e,t.userId);else{let t=await w();await t.put(d,e),await p()}},b=async e=>{let t=(await w()).transaction(d,"readwrite");for(let r of e)await t.store.put(r);await t.done,await p()},I=async()=>{let e=await w();await e.clear(d)},S=e=>!!(e?.userId&&e?.isAuthenticated),x=(e,t,r)=>({id:e.id,user_id:t,date:e.date,time:e.time||null,meal_type:e.mealType,menu:e.menu||null,photo_url:r,created_at:e.createdAt}),j=async e=>{let t;if(e.photo_url){let r=await l(e.photo_url);if(r)try{let e=await fetch(r);t=await e.blob()}catch(e){console.error("写真の取得に失敗しました:",e)}}return{id:e.id,date:e.date,time:e.time||void 0,mealType:e.meal_type,menu:e.menu||void 0,photo:t,createdAt:e.created_at}},D=async(e,t)=>{let r=(0,i.e)();if(!r)throw Error("Supabase が設定されていません");let a=null;e.photo&&(a=await s(t,e.id,e.photo));let n=x(e,t,a),{error:o}=await r.from("food_entries").insert(n);if(o)throw a&&await u(a),o},P=async e=>{let t=(0,i.e)();if(!t)return[];let{data:r,error:a}=await t.from("food_entries").select("*").eq("user_id",e).order("date",{ascending:!1}).order("time",{ascending:!1,nullsFirst:!1});return a?(console.error("Supabase からの取得エラー:",a),[]):await Promise.all(r.map(j))},E=async(e,t)=>{let r=(0,i.e)();if(!r)return;let{data:a,error:n}=await r.from("food_entries").select("*").eq("id",e).eq("user_id",t).single();if(n){console.error("Supabase からの取得エラー:",n);return}return j(a)},B=async(e,t)=>{let r=(0,i.e)();if(!r)throw Error("Supabase が設定されていません");let{data:a}=await r.from("food_entries").select("photo_url").eq("id",e.id).eq("user_id",t).single(),n=a?.photo_url||null;e.photo?n=await s(t,e.id,e.photo):n&&!e.photo&&(await u(n),n=null);let o=x(e,t,n),{error:l}=await r.from("food_entries").update(o).eq("id",e.id).eq("user_id",t);if(l)throw l},A=async(e,t)=>{let r=(0,i.e)();if(!r)throw Error("Supabase が設定されていません");let{data:a}=await r.from("food_entries").select("photo_url").eq("id",e).eq("user_id",t).single(),n=a?.photo_url;n&&await u(n);let{error:o}=await r.from("food_entries").delete().eq("id",e).eq("user_id",t);if(o)throw o},C=async(e,t=800,r=800,a=.8)=>new Promise((n,i)=>{let o=new FileReader;o.readAsDataURL(e),o.onload=e=>{let o=new Image;o.src=e.target?.result,o.onload=()=>{let e=document.createElement("canvas"),s=o.width,l=o.height;s>l?s>t&&(l*=t/s,s=t):l>r&&(s*=r/l,l=r),e.width=s,e.height=l;let u=e.getContext("2d");u?.drawImage(o,0,0,s,l),e.toBlob(e=>{e?n(e):i(Error("画像の圧縮に失敗しました"))},"image/jpeg",a)},o.onerror=i},o.onerror=i})},333:(e,t,r)=>{"use strict";r.d(t,{DB:()=>o,Is:()=>g,OK:()=>w,VE:()=>y,eR:()=>m,j7:()=>d,saveToFile:()=>h,vU:()=>v,yv:()=>c});let a="foodiary-data.json",n="file-handles",i="directory-handle",o=()=>"showDirectoryPicker"in window,s=async e=>{let{openDB:t}=await Promise.resolve().then(r.bind(r,8505)),a=await t("FileHandleStore",1,{upgrade(e){e.objectStoreNames.contains(n)||e.createObjectStore(n)}});await a.put(n,e,i)},l=async()=>{try{let{openDB:e}=await Promise.resolve().then(r.bind(r,8505)),t=await e("FileHandleStore",1,{upgrade(e){e.objectStoreNames.contains(n)||e.createObjectStore(n)}});return await t.get(n,i)||null}catch{return null}},u=async e=>{let t={mode:"readwrite"};return await e.queryPermission(t)==="granted"||await e.requestPermission(t)==="granted"},d=async()=>{if(!o())return null;try{let e=await window.showDirectoryPicker({mode:"readwrite",startIn:"documents"});return await s(e),e}catch(e){if(e instanceof Error&&"AbortError"===e.name)return null;throw e}},c=async()=>{let e=await l();return e&&await u(e)?e:null},w=async()=>null!==await l(),p=async e=>{let t={...e};if(e.photo instanceof Blob){let r=new FileReader,a=await new Promise((t,a)=>{r.onload=()=>t(r.result),r.onerror=a,r.readAsDataURL(e.photo)});t.photo=a,t._photoIsBase64=!0}return t},f=async e=>{let{_photoIsBase64:t,...r}=e,a=r.mealType||"昼食",n=r.menu||r.menuName,i={id:r.id,date:r.date,time:r.time,mealType:a,menu:n,photo:r.photo,createdAt:r.createdAt};if(t&&"string"==typeof r.photo){let e=await fetch(r.photo);i.photo=await e.blob()}return i},h=async e=>{let t=await c();if(!t)return!1;try{let r=await t.getFileHandle(a,{create:!0}),n=await r.createWritable(),i=await Promise.all(e.map(e=>p(e))),o=JSON.stringify({version:1,exportedAt:new Date().toISOString(),entries:i},null,2);return await n.write(o),await n.close(),!0}catch(e){return console.error("ファイルへの保存に失敗しました:",e),!1}},m=async()=>{let e=await c();if(!e)return null;try{let t=await e.getFileHandle(a),r=await t.getFile(),n=await r.text(),i=JSON.parse(n);if(!i.entries||!Array.isArray(i.entries))return null;return await Promise.all(i.entries.map(e=>f(e)))}catch(e){if(e instanceof Error&&"NotFoundError"===e.name)return[];return console.error("ファイルからの読み込みに失敗しました:",e),null}},y=async e=>{let t=await Promise.all(e.map(e=>p(e))),r=JSON.stringify({version:1,exportedAt:new Date().toISOString(),entries:t},null,2),a=new Blob([r],{type:"application/json"}),n=URL.createObjectURL(a),i=document.createElement("a");i.href=n,i.download=`foodiary-backup-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(n)},g=async e=>{let t=JSON.parse(await e.text());if(!t.entries||!Array.isArray(t.entries))throw Error("無効なファイル形式です");return await Promise.all(t.entries.map(e=>f(e)))},v=async()=>{let{openDB:e}=await Promise.resolve().then(r.bind(r,8505)),t=await e("FileHandleStore",1,{upgrade(e){e.objectStoreNames.contains(n)||e.createObjectStore(n)}});await t.delete(n,i)}},8704:(e,t,r)=>{"use strict";r.d(t,{e:()=>l,j:()=>o});var a=r(3974);let n="https://lebexzzbtaiuegztwupu.supabase.co",i="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxlYmV4enpidGFpdWVnenR3dXB1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk1NDQ5ODYsImV4cCI6MjA4NTEyMDk4Nn0.R0AGgMNWuhnWeNz6TpGQOB9yVWj7NGkZDGV_M4o9Sgo",o=()=>!!(n&&i),s=null,l=()=>o()?(s||(s=(0,a.createBrowserClient)(n,i)),s):null},6313:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>f,metadata:()=>p,viewport:()=>w});var a=r(5036),n=r(3640),i=r.n(n);r(5023);var o=r(5411),s=r(6843);let l=(0,s.createProxy)(String.raw`C:\Tools\foodiary\src\contexts\AuthContext.tsx`),{__esModule:u,$$typeof:d}=l;l.default;let c=(0,s.createProxy)(String.raw`C:\Tools\foodiary\src\contexts\AuthContext.tsx#AuthProvider`);(0,s.createProxy)(String.raw`C:\Tools\foodiary\src\contexts\AuthContext.tsx#useAuth`);let w={width:"device-width",initialScale:1,maximumScale:1,userScalable:!1,themeColor:"#10b981"},p={title:"食事記録アプリ",description:"食べたものを写真とメモで記録",manifest:"/manifest.json",appleWebApp:{capable:!0,statusBarStyle:"default",title:"食事記録"}};function f({children:e}){return(0,a.jsxs)("html",{lang:"ja",children:[(0,a.jsxs)("head",{children:[a.jsx("link",{rel:"icon",href:"/icon.svg",type:"image/svg+xml"}),a.jsx("link",{rel:"apple-touch-icon",href:"/icon.svg"})]}),(0,a.jsxs)("body",{className:i().className,children:[a.jsx(c,{children:e}),a.jsx(o.default,{id:"register-sw",strategy:"afterInteractive",children:`
            // Service Worker がサポートされているか確認
            if ('serviceWorker' in navigator) {
              // ページ読み込み完了後に登録
              window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js').then(
                  (registration) => {
                    console.log('Service Worker registered:', registration);
                  },
                  (error) => {
                    console.log('Service Worker registration failed:', error);
                  }
                );
              });
            }
          `})]})]})}},7026:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>n});var a=r(337);let n=e=>[{type:"image/svg+xml",sizes:"any",url:(0,a.fillMetadataSegment)(".",e.params,"icon.svg")+"?bddd94b2250e474a"}]},5023:()=>{},8505:(e,t,r)=>{"use strict";var a,n;let i,o;r.d(t,{openDB:()=>f});let s=(e,t)=>t.some(t=>e instanceof t),l=new WeakMap,u=new WeakMap,d=new WeakMap,c={get(e,t,r){if(e instanceof IDBTransaction){if("done"===t)return l.get(e);if("store"===t)return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return w(e[t])},set:(e,t,r)=>(e[t]=r,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function w(e){var t;if(e instanceof IDBRequest)return function(e){let t=new Promise((t,r)=>{let a=()=>{e.removeEventListener("success",n),e.removeEventListener("error",i)},n=()=>{t(w(e.result)),a()},i=()=>{r(e.error),a()};e.addEventListener("success",n),e.addEventListener("error",i)});return d.set(t,e),t}(e);if(u.has(e))return u.get(e);let r="function"==typeof(t=e)?(o||(o=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(...e){return t.apply(p(this),e),w(this.request)}:function(...e){return w(t.apply(p(this),e))}:(t instanceof IDBTransaction&&function(e){if(l.has(e))return;let t=new Promise((t,r)=>{let a=()=>{e.removeEventListener("complete",n),e.removeEventListener("error",i),e.removeEventListener("abort",i)},n=()=>{t(),a()},i=()=>{r(e.error||new DOMException("AbortError","AbortError")),a()};e.addEventListener("complete",n),e.addEventListener("error",i),e.addEventListener("abort",i)});l.set(e,t)}(t),s(t,i||(i=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])))?new Proxy(t,c):t;return r!==e&&(u.set(e,r),d.set(r,e)),r}let p=e=>d.get(e);function f(e,t,{blocked:r,upgrade:a,blocking:n,terminated:i}={}){let o=indexedDB.open(e,t),s=w(o);return a&&o.addEventListener("upgradeneeded",e=>{a(w(o.result),e.oldVersion,e.newVersion,w(o.transaction),e)}),r&&o.addEventListener("blocked",e=>r(e.oldVersion,e.newVersion,e)),s.then(e=>{i&&e.addEventListener("close",()=>i()),n&&e.addEventListener("versionchange",e=>n(e.oldVersion,e.newVersion,e))}).catch(()=>{}),s}let h=["get","getKey","getAll","getAllKeys","count"],m=["put","add","delete","clear"],y=new Map;function g(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&"string"==typeof t))return;if(y.get(t))return y.get(t);let r=t.replace(/FromIndex$/,""),a=t!==r,n=m.includes(r);if(!(r in(a?IDBIndex:IDBObjectStore).prototype)||!(n||h.includes(r)))return;let i=async function(e,...t){let i=this.transaction(e,n?"readwrite":"readonly"),o=i.store;return a&&(o=o.index(t.shift())),(await Promise.all([o[r](...t),n&&i.done]))[0]};return y.set(t,i),i}c={...a=c,get:(e,t,r)=>g(e,t)||a.get(e,t,r),has:(e,t)=>!!g(e,t)||a.has(e,t)};let v=["continue","continuePrimaryKey","advance"],b={},I=new WeakMap,S=new WeakMap,x={get(e,t){if(!v.includes(t))return e[t];let r=b[t];return r||(r=b[t]=function(...e){I.set(this,S.get(this)[t](...e))}),r}};async function*j(...e){let t=this;if(t instanceof IDBCursor||(t=await t.openCursor(...e)),!t)return;let r=new Proxy(t,x);for(S.set(r,t),d.set(r,p(t));t;)yield r,t=await (I.get(r)||t.continue()),I.delete(r)}function D(e,t){return t===Symbol.asyncIterator&&s(e,[IDBIndex,IDBObjectStore,IDBCursor])||"iterate"===t&&s(e,[IDBIndex,IDBObjectStore])}c={...n=c,get:(e,t,r)=>D(e,t)?j:n.get(e,t,r),has:(e,t)=>D(e,t)||n.has(e,t)}}};