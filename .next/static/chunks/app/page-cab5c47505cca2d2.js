(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{8529:function(e,t,r){Promise.resolve().then(r.bind(r,5096))},5096:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return c}});var a=r(3827),n=r(4090),i=r(8792),o=r(3669);function s(e){let{entry:t,onDelete:r}=e,[i,o]=(0,n.useState)("");return(0,n.useEffect)(()=>{if(t.photo){let e=URL.createObjectURL(t.photo);return o(e),()=>URL.revokeObjectURL(e)}},[t.photo]),(0,a.jsxs)("div",{className:"bg-white rounded-2xl shadow-lg overflow-hidden hover:shadow-xl transition-shadow",children:[i&&(0,a.jsx)("div",{className:"w-full h-64 bg-gray-100",children:(0,a.jsx)("img",{src:i,alt:t.mealType,className:"w-full h-full object-cover"})}),(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"inline-block bg-green-100 text-green-800 text-sm font-medium px-3 py-1 rounded-full mb-2",children:t.mealType}),t.menu&&(0,a.jsx)("h2",{className:"text-xl font-bold text-gray-800",children:t.menu})]}),(0,a.jsx)("button",{onClick:()=>r(t.id),className:"text-red-500 hover:text-red-700 transition p-2 hover:bg-red-50 rounded-lg",title:"削除",children:(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]}),(0,a.jsxs)("p",{className:"text-gray-600 flex items-center",children:[(0,a.jsx)("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})}),new Date(t.date).toLocaleDateString("ja-JP",{year:"numeric",month:"long",day:"numeric",weekday:"short"}),t.time&&(0,a.jsxs)("span",{className:"ml-3 flex items-center",children:[(0,a.jsx)("svg",{className:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),t.time]})]})]})]})}function l(){return(0,a.jsx)(i.default,{href:"/add",className:"fixed bottom-6 right-6 bg-green-500 hover:bg-green-600 text-white rounded-full p-4 shadow-2xl transition transform hover:scale-110 active:scale-95 z-50",children:(0,a.jsx)("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})})})}function c(){let[e,t]=(0,n.useState)([]),[r,c]=(0,n.useState)(!0),d=async()=>{try{let e=await (0,o.C0)();t(e)}catch(e){console.error("データの読み込みに失敗しました:",e)}finally{c(!1)}};(0,n.useEffect)(()=>{d()},[]);let u=async e=>{if(confirm("この記録を削除しますか?"))try{await (0,o.pO)(e),await d()}catch(e){console.error("削除に失敗しました:",e),alert("削除に失敗しました")}};return(0,a.jsxs)("main",{className:"min-h-screen bg-gradient-to-b from-green-50 to-white pb-20",children:[(0,a.jsxs)("div",{className:"max-w-2xl mx-auto px-4 py-6",children:[(0,a.jsxs)("header",{className:"mb-8 flex items-start justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-800 mb-2",children:"\uD83C\uDF7D️ 食事記録"}),(0,a.jsx)("p",{className:"text-gray-600",children:"食べたものを記録しよう"})]}),(0,a.jsx)(i.default,{href:"/settings",className:"p-2 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-lg transition",title:"設定",children:(0,a.jsxs)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]})})]}),r?(0,a.jsxs)("div",{className:"text-center py-20",children:[(0,a.jsx)("div",{className:"inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-green-500"}),(0,a.jsx)("p",{className:"mt-4 text-gray-600",children:"読み込み中..."})]}):0===e.length?(0,a.jsxs)("div",{className:"text-center py-20",children:[(0,a.jsx)("p",{className:"text-6xl mb-4",children:"\uD83D\uDCDD"}),(0,a.jsx)("p",{className:"text-gray-600 mb-2",children:"まだ記録がありません"}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"右下のボタンから記録を追加しましょう"})]}):(0,a.jsx)("div",{className:"space-y-4",children:e.map(e=>(0,a.jsx)(s,{entry:e,onDelete:u},e.id))})]}),(0,a.jsx)(l,{})]})}},3669:function(e,t,r){"use strict";r.d(t,{C0:function(){return u},PZ:function(){return m},Ps:function(){return w},hv:function(){return x},pO:function(){return h},px:function(){return d}});var a=r(7012),n=r(1161);let i="entries",o=null,s=()=>(o||(o=(0,a.openDB)("FoodDiaryDB",1,{upgrade(e){e.objectStoreNames.contains(i)||e.createObjectStore(i,{keyPath:"id"}).createIndex("by-date","date")}})),o),l=async()=>{try{if(await (0,n.yv)()){let e=await c();await (0,n.saveToFile)(e)}}catch(e){console.error("ファイル同期に失敗しました:",e)}},c=async()=>{let e=await s();return(await e.getAllFromIndex(i,"by-date")).reverse()},d=async e=>{let t=await s();await t.add(i,e),await l()},u=async()=>c(),h=async e=>{let t=await s();await t.delete(i,e),await l()},m=async e=>{let t=(await s()).transaction(i,"readwrite");for(let r of e)await t.store.put(r);await t.done,await l()},w=async()=>{let e=await s();await e.clear(i)},x=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:800,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:800,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.8;return new Promise((n,i)=>{let o=new FileReader;o.readAsDataURL(e),o.onload=e=>{var o;let s=new Image;s.src=null===(o=e.target)||void 0===o?void 0:o.result,s.onload=()=>{let e=document.createElement("canvas"),o=s.width,l=s.height;o>l?o>t&&(l*=t/o,o=t):l>r&&(o*=r/l,l=r),e.width=o,e.height=l;let c=e.getContext("2d");null==c||c.drawImage(s,0,0,o,l),e.toBlob(e=>{e?n(e):i(Error("画像の圧縮に失敗しました"))},"image/jpeg",a)},s.onerror=i},o.onerror=i})}},1161:function(e,t,r){"use strict";r.d(t,{DB:function(){return o},Is:function(){return y},OK:function(){return h},VE:function(){return p},eR:function(){return f},j7:function(){return d},saveToFile:function(){return x},vU:function(){return g},yv:function(){return u}});let a="foodiary-data.json",n="file-handles",i="directory-handle",o=()=>"showDirectoryPicker"in window,s=async e=>{let{openDB:t}=await Promise.resolve().then(r.bind(r,7012)),a=await t("FileHandleStore",1,{upgrade(e){e.objectStoreNames.contains(n)||e.createObjectStore(n)}});await a.put(n,e,i)},l=async()=>{try{let{openDB:e}=await Promise.resolve().then(r.bind(r,7012)),t=await e("FileHandleStore",1,{upgrade(e){e.objectStoreNames.contains(n)||e.createObjectStore(n)}});return await t.get(n,i)||null}catch(e){return null}},c=async e=>{let t={mode:"readwrite"};return await e.queryPermission(t)==="granted"||await e.requestPermission(t)==="granted"},d=async()=>{if(!o())return null;try{let e=await window.showDirectoryPicker({mode:"readwrite",startIn:"documents"});return await s(e),e}catch(e){if(e instanceof Error&&"AbortError"===e.name)return null;throw e}},u=async()=>{let e=await l();return e&&await c(e)?e:null},h=async()=>null!==await l(),m=async e=>{let t={...e};if(e.photo instanceof Blob){let r=new FileReader,a=await new Promise((t,a)=>{r.onload=()=>t(r.result),r.onerror=a,r.readAsDataURL(e.photo)});t.photo=a,t._photoIsBase64=!0}return t},w=async e=>{let{_photoIsBase64:t,...r}=e,a=r.mealType||"昼食",n=r.menu||r.menuName,i={id:r.id,date:r.date,time:r.time,mealType:a,menu:n,photo:r.photo,createdAt:r.createdAt};if(t&&"string"==typeof r.photo){let e=await fetch(r.photo);i.photo=await e.blob()}return i},x=async e=>{let t=await u();if(!t)return!1;try{let r=await t.getFileHandle(a,{create:!0}),n=await r.createWritable(),i=await Promise.all(e.map(e=>m(e))),o=JSON.stringify({version:1,exportedAt:new Date().toISOString(),entries:i},null,2);return await n.write(o),await n.close(),!0}catch(e){return console.error("ファイルへの保存に失敗しました:",e),!1}},f=async()=>{let e=await u();if(!e)return null;try{let t=await e.getFileHandle(a),r=await t.getFile(),n=await r.text(),i=JSON.parse(n);if(!i.entries||!Array.isArray(i.entries))return null;return await Promise.all(i.entries.map(e=>w(e)))}catch(e){if(e instanceof Error&&"NotFoundError"===e.name)return[];return console.error("ファイルからの読み込みに失敗しました:",e),null}},p=async e=>{let t=await Promise.all(e.map(e=>m(e))),r=JSON.stringify({version:1,exportedAt:new Date().toISOString(),entries:t},null,2),a=new Blob([r],{type:"application/json"}),n=URL.createObjectURL(a),i=document.createElement("a");i.href=n,i.download="foodiary-backup-".concat(new Date().toISOString().split("T")[0],".json"),document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(n)},y=async e=>{let t=JSON.parse(await e.text());if(!t.entries||!Array.isArray(t.entries))throw Error("無効なファイル形式です");return await Promise.all(t.entries.map(e=>w(e)))},g=async()=>{let{openDB:e}=await Promise.resolve().then(r.bind(r,7012)),t=await e("FileHandleStore",1,{upgrade(e){e.objectStoreNames.contains(n)||e.createObjectStore(n)}});await t.delete(n,i)}}},function(e){e.O(0,[746,971,69,744],function(){return e(e.s=8529)}),_N_E=e.O()}]);