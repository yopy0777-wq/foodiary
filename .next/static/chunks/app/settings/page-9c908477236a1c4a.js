(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[938],{2293:function(e,t,a){Promise.resolve().then(a.bind(a,1077))},1077:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return o}});var r=a(3827),n=a(4090),i=a(8792),s=a(3669),l=a(1161);function o(){let[e,t]=(0,n.useState)(!1),[o,c]=(0,n.useState)(!1),[d,u]=(0,n.useState)(!0),[h,w]=(0,n.useState)(!1),[m,x]=(0,n.useState)(null),g=(0,n.useRef)(null);(0,n.useEffect)(()=>{(async()=>{let e=(0,l.DB)();t(e),e&&c(await (0,l.OK)()),u(!1)})()},[]);let y=(e,t)=>{x({type:e,text:t}),setTimeout(()=>x(null),3e3)},f=async()=>{try{if(await (0,l.j7)()){c(!0),y("success","フォルダを設定しました。データが自動保存されます。");let e=await (0,s.C0)();if(e.length>0){let{saveToFile:t}=await Promise.resolve().then(a.bind(a,1161));await t(e)}}}catch(e){console.error("フォルダ選択に失敗しました:",e),y("error","フォルダの選択に失敗しました")}},p=async()=>{confirm("フォルダ設定を解除しますか？\n（保存済みのファイルは削除されません）")&&(await (0,l.vU)(),c(!1),y("success","フォルダ設定を解除しました"))},b=async()=>{if(confirm("ファイルからデータを読み込みますか？\n現在のデータはファイルの内容で上書きされます。")){w(!0);try{let e=await (0,l.eR)();if(null===e){y("error","ファイルの読み込みに失敗しました");return}await (0,s.Ps)(),e.length>0&&await (0,s.PZ)(e),y("success","".concat(e.length,"件のデータを読み込みました"))}catch(e){console.error("同期に失敗しました:",e),y("error","同期に失敗しました")}finally{w(!1)}}},v=async()=>{try{let e=await (0,s.C0)();await (0,l.VE)(e),y("success","データをエクスポートしました")}catch(e){console.error("エクスポートに失敗しました:",e),y("error","エクスポートに失敗しました")}},j=async e=>{var t;let a=null===(t=e.target.files)||void 0===t?void 0:t[0];if(a){if(!confirm("ファイルからデータをインポートしますか？\n同じIDのデータは上書きされます。")){e.target.value="";return}try{let e=await (0,l.Is)(a);await (0,s.PZ)(e),y("success","".concat(e.length,"件のデータをインポートしました"))}catch(e){console.error("インポートに失敗しました:",e),y("error","インポートに失敗しました。ファイル形式を確認してください。")}finally{e.target.value=""}}};return(0,r.jsx)("main",{className:"min-h-screen bg-gradient-to-b from-green-50 to-white",children:(0,r.jsxs)("div",{className:"max-w-2xl mx-auto px-4 py-6",children:[(0,r.jsxs)("header",{className:"mb-8 flex items-center",children:[(0,r.jsx)(i.default,{href:"/",className:"mr-4 text-gray-600 hover:text-gray-800 transition",children:(0,r.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),(0,r.jsx)("h1",{className:"text-3xl font-bold text-gray-800",children:"設定"})]}),m&&(0,r.jsx)("div",{className:"mb-6 p-4 rounded-lg ".concat("success"===m.type?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:m.text}),(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("section",{className:"bg-white rounded-2xl shadow-lg p-6",children:[(0,r.jsx)("h2",{className:"text-xl font-bold text-gray-800 mb-4",children:"自動保存"}),d?(0,r.jsx)("div",{className:"text-gray-600",children:"読み込み中..."}):e?o?(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex items-center text-green-600",children:[(0,r.jsx)("svg",{className:"w-5 h-5 mr-2",fill:"currentColor",viewBox:"0 0 20 20",children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),(0,r.jsx)("span",{children:"自動保存が有効です"})]}),(0,r.jsx)("p",{className:"text-sm text-gray-600",children:"データは自動的にローカルフォルダに保存されます。"}),(0,r.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,r.jsx)("button",{onClick:b,disabled:h,className:"px-4 py-2 bg-blue-500 hover:bg-blue-600 disabled:bg-gray-400 text-white rounded-lg transition",children:h?"読み込み中...":"ファイルから読み込む"}),(0,r.jsx)("button",{onClick:p,className:"px-4 py-2 bg-gray-500 hover:bg-gray-600 text-white rounded-lg transition",children:"設定を解除"})]})]}):(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)("p",{className:"text-gray-600",children:"フォルダを選択すると、データが自動的にローカルファイルに保存されます。 ブラウザのデータを削除しても、ファイルからデータを復元できます。"}),(0,r.jsx)("button",{onClick:f,className:"px-4 py-2 bg-green-500 hover:bg-green-600 text-white rounded-lg transition",children:"保存フォルダを選択"})]}):(0,r.jsxs)("div",{className:"text-gray-600",children:[(0,r.jsx)("p",{className:"mb-2",children:"このブラウザは自動保存に対応していません。"}),(0,r.jsx)("p",{className:"text-sm text-gray-500",children:"Chrome または Edge を使用すると、ローカルフォルダへの自動保存が利用できます。"})]})]}),(0,r.jsxs)("section",{className:"bg-white rounded-2xl shadow-lg p-6",children:[(0,r.jsx)("h2",{className:"text-xl font-bold text-gray-800 mb-4",children:"手動バックアップ"}),(0,r.jsx)("p",{className:"text-gray-600 mb-4",children:"全ブラウザ対応。JSONファイルとしてデータをダウンロード・復元できます。"}),(0,r.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,r.jsx)("button",{onClick:v,className:"px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg transition",children:"データをエクスポート"}),(0,r.jsx)("button",{onClick:()=>{var e;null===(e=g.current)||void 0===e||e.click()},className:"px-4 py-2 bg-orange-500 hover:bg-orange-600 text-white rounded-lg transition",children:"データをインポート"}),(0,r.jsx)("input",{ref:g,type:"file",accept:".json",onChange:j,className:"hidden"})]})]})]})]})})}},3669:function(e,t,a){"use strict";a.d(t,{C0:function(){return u},PZ:function(){return w},Ps:function(){return m},hv:function(){return x},pO:function(){return h},px:function(){return d}});var r=a(7012),n=a(1161);let i="entries",s=null,l=()=>(s||(s=(0,r.openDB)("FoodDiaryDB",1,{upgrade(e){e.objectStoreNames.contains(i)||e.createObjectStore(i,{keyPath:"id"}).createIndex("by-date","date")}})),s),o=async()=>{try{if(await (0,n.yv)()){let e=await c();await (0,n.saveToFile)(e)}}catch(e){console.error("ファイル同期に失敗しました:",e)}},c=async()=>{let e=await l();return(await e.getAllFromIndex(i,"by-date")).reverse()},d=async e=>{let t=await l();await t.add(i,e),await o()},u=async()=>c(),h=async e=>{let t=await l();await t.delete(i,e),await o()},w=async e=>{let t=(await l()).transaction(i,"readwrite");for(let a of e)await t.store.put(a);await t.done,await o()},m=async()=>{let e=await l();await e.clear(i)},x=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:800,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:800,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.8;return new Promise((n,i)=>{let s=new FileReader;s.readAsDataURL(e),s.onload=e=>{var s;let l=new Image;l.src=null===(s=e.target)||void 0===s?void 0:s.result,l.onload=()=>{let e=document.createElement("canvas"),s=l.width,o=l.height;s>o?s>t&&(o*=t/s,s=t):o>a&&(s*=a/o,o=a),e.width=s,e.height=o;let c=e.getContext("2d");null==c||c.drawImage(l,0,0,s,o),e.toBlob(e=>{e?n(e):i(Error("画像の圧縮に失敗しました"))},"image/jpeg",r)},l.onerror=i},s.onerror=i})}},1161:function(e,t,a){"use strict";a.d(t,{DB:function(){return s},Is:function(){return f},OK:function(){return h},VE:function(){return y},eR:function(){return g},j7:function(){return d},saveToFile:function(){return x},vU:function(){return p},yv:function(){return u}});let r="foodiary-data.json",n="file-handles",i="directory-handle",s=()=>"showDirectoryPicker"in window,l=async e=>{let{openDB:t}=await Promise.resolve().then(a.bind(a,7012)),r=await t("FileHandleStore",1,{upgrade(e){e.objectStoreNames.contains(n)||e.createObjectStore(n)}});await r.put(n,e,i)},o=async()=>{try{let{openDB:e}=await Promise.resolve().then(a.bind(a,7012)),t=await e("FileHandleStore",1,{upgrade(e){e.objectStoreNames.contains(n)||e.createObjectStore(n)}});return await t.get(n,i)||null}catch(e){return null}},c=async e=>{let t={mode:"readwrite"};return await e.queryPermission(t)==="granted"||await e.requestPermission(t)==="granted"},d=async()=>{if(!s())return null;try{let e=await window.showDirectoryPicker({mode:"readwrite",startIn:"documents"});return await l(e),e}catch(e){if(e instanceof Error&&"AbortError"===e.name)return null;throw e}},u=async()=>{let e=await o();return e&&await c(e)?e:null},h=async()=>null!==await o(),w=async e=>{let t={...e};if(e.photo instanceof Blob){let a=new FileReader,r=await new Promise((t,r)=>{a.onload=()=>t(a.result),a.onerror=r,a.readAsDataURL(e.photo)});t.photo=r,t._photoIsBase64=!0}return t},m=async e=>{let{_photoIsBase64:t,...a}=e,r={id:a.id,date:a.date,time:a.time,menuName:a.menuName,photo:a.photo,createdAt:a.createdAt};if(t&&"string"==typeof a.photo){let e=await fetch(a.photo);r.photo=await e.blob()}return r},x=async e=>{let t=await u();if(!t)return!1;try{let a=await t.getFileHandle(r,{create:!0}),n=await a.createWritable(),i=await Promise.all(e.map(e=>w(e))),s=JSON.stringify({version:1,exportedAt:new Date().toISOString(),entries:i},null,2);return await n.write(s),await n.close(),!0}catch(e){return console.error("ファイルへの保存に失敗しました:",e),!1}},g=async()=>{let e=await u();if(!e)return null;try{let t=await e.getFileHandle(r),a=await t.getFile(),n=await a.text(),i=JSON.parse(n);if(!i.entries||!Array.isArray(i.entries))return null;return await Promise.all(i.entries.map(e=>m(e)))}catch(e){if(e instanceof Error&&"NotFoundError"===e.name)return[];return console.error("ファイルからの読み込みに失敗しました:",e),null}},y=async e=>{let t=await Promise.all(e.map(e=>w(e))),a=JSON.stringify({version:1,exportedAt:new Date().toISOString(),entries:t},null,2),r=new Blob([a],{type:"application/json"}),n=URL.createObjectURL(r),i=document.createElement("a");i.href=n,i.download="foodiary-backup-".concat(new Date().toISOString().split("T")[0],".json"),document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(n)},f=async e=>{let t=JSON.parse(await e.text());if(!t.entries||!Array.isArray(t.entries))throw Error("無効なファイル形式です");return await Promise.all(t.entries.map(e=>m(e)))},p=async()=>{let{openDB:e}=await Promise.resolve().then(a.bind(a,7012)),t=await e("FileHandleStore",1,{upgrade(e){e.objectStoreNames.contains(n)||e.createObjectStore(n)}});await t.delete(n,i)}}},function(e){e.O(0,[746,971,69,744],function(){return e(e.s=2293)}),_N_E=e.O()}]);